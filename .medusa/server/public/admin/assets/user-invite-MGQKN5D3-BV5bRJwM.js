import{u as M}from"./chunk-C76H5USB-CRnGW_j5.js";import{u as A,_ as T}from"./chunk-B2JT2FOA-I3neUhSS.js";import{j as e,b as g,ac as k,ad as D,eM as C,H as I,J as P,w as m,I as E,B as F,r as U,f as R,_ as f,b9 as u,a6 as L,A as H,eN as O,T as z,a8 as B,bg as $}from"./index-C_TCY6wF.js";import"./chunk-GJUPECDU-DTjacOEq.js";import{K as q}from"./chunk-6HTZNHPT-C3g-6wSS.js";import{R as p}from"./chunk-4TC5YS65-C1s3AhWO.js";import{u as J,a as K,b as Q,c as V}from"./chunk-RLY2SL5E-a2KiW6lS.js";import{T as G}from"./Trans-Bk6EMC52.js";import{u as W}from"./use-prompt-CbyUW0t8.js";import{A as X}from"./arrow-path-DZm_hX0W.js";import{A as Y}from"./alert-BMceS-AR.js";import{C as Z}from"./container-6CYjBT1Z.js";import{S as v}from"./status-badge-CnQgIQxj.js";import"./chunk-YEDAFXMB-BBTtrFp_.js";import"./chunk-M3VFKDXJ-Dl-TA9nF.js";import"./chunk-AOFGTNG6-C1eADjrF.js";import"./table-CTAw1yCu.js";import"./chunk-EMIHDNB7-CdXyYQls.js";import"./command-bar-DscPhTam.js";import"./chunk-PFKKVLZX-BinEmjmC.js";import"./_isIndex-IQAKbMKi.js";import"./date-picker-XI5VNAa_.js";import"./clsx-B-dksMZM.js";import"./popover-CXBXA6aZ.js";import"./triangle-left-mini-z-W_Cr34.js";import"./prompt-B3qCXbW-.js";var ee=({prefix:s,pageSize:a=20})=>{const t=M(["offset","q","order","created_at","updated_at"],s),{offset:i,created_at:r,updated_at:n,q:o,order:l}=t;return{searchParams:{limit:a,offset:i?Number(i):0,order:l,created_at:r?JSON.parse(r):void 0,updated_at:n?JSON.parse(n):void 0,q:o},raw:t}},se=L({email:B().email()}),y=10,h="usr_invite",ae=`${window.location.origin}/app/invite?token=`,re=()=>{const{t:s}=g(),a=k({defaultValues:{email:""},resolver:D(se)}),{raw:t,searchParams:i}=ee({prefix:h,pageSize:y}),{invites:r,count:n,isPending:o,isError:l,error:c}=J(i),b=ie(),{table:w}=A({data:r??[],columns:b,count:n,enablePagination:!0,getRowId:d=>d.id,pageSize:y,prefix:h}),{mutateAsync:_,isPending:N}=K(),S=a.handleSubmit(async d=>{try{await _({email:d.email}),a.reset()}catch(x){if(C(x)&&x.status===400){a.setError("root",{type:"manual",message:x.message});return}}});if(l)throw c;return e.jsx(p.Form,{form:a,children:e.jsxs(q,{onSubmit:S,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(p.Header,{}),e.jsx(p.Body,{className:"flex flex-1 flex-col overflow-hidden",children:e.jsx("div",{className:"flex flex-1 flex-col items-center overflow-y-auto",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 px-2 py-16",children:[e.jsxs("div",{children:[e.jsx(I,{children:s("users.inviteUser")}),e.jsx(P,{size:"small",className:"text-ui-fg-subtle",children:s("users.inviteUserHint")})]}),a.formState.errors.root&&e.jsx(Y,{variant:"error",dismissible:!1,className:"text-balance",children:a.formState.errors.root.message}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsx(m.Field,{control:a.control,name:"email",render:({field:d})=>e.jsxs(m.Item,{children:[e.jsx(m.Label,{children:s("fields.email")}),e.jsx(m.Control,{children:e.jsx(E,{...d})}),e.jsx(m.ErrorMessage,{})]})})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(F,{size:"small",variant:"secondary",type:"submit",isLoading:N,children:s("users.sendInvite")})})]}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(I,{level:"h2",children:s("users.pendingInvites")}),e.jsx(Z,{className:"overflow-hidden p-0",children:e.jsx(T,{table:w,columns:b,count:n,pageSize:y,pagination:!0,search:"autofocus",isLoading:o,queryObject:t,prefix:h,orderBy:[{key:"email",label:s("fields.email")},{key:"created_at",label:s("fields.createdAt")},{key:"updated_at",label:s("fields.updatedAt")}]})})]})]})})})]})})},te=({invite:s})=>{const{mutateAsync:a}=Q(s.id),{mutateAsync:t}=V(s.id),i=W(),{t:r}=g(),n=async()=>{await i({title:r("general.areYouSure"),description:r("users.deleteInviteWarning",{email:s.email}),cancelText:r("actions.cancel"),confirmText:r("actions.delete")})&&await a()},o=async()=>{await t()},l=()=>{const c=`${ae}${s.token}`;$(c)};return e.jsx(H,{groups:[{actions:[{icon:e.jsx(X,{}),label:r("users.resendInvite"),onClick:o}]},{actions:[{icon:e.jsx(O,{}),label:r("users.copyInviteLink"),onClick:l}]},{actions:[{icon:e.jsx(z,{}),label:r("actions.delete"),onClick:n}]}]})},j=R(),ie=()=>{const{t:s}=g();return U.useMemo(()=>[j.accessor("email",{header:s("fields.email"),cell:({getValue:a})=>a()}),j.accessor("accepted",{header:s("fields.status"),cell:({getValue:a,row:t})=>{const i=a(),r=new Date(t.original.expires_at)<new Date;return i?e.jsx(f,{content:s("users.acceptedOnDate",{date:u(new Date(t.original.updated_at),"dd MMM, yyyy")}),children:e.jsx(v,{color:"green",children:s("users.inviteStatus.accepted")})}):r?e.jsx(f,{content:s("users.expiredOnDate",{date:u(new Date(t.original.expires_at),"dd MMM, yyyy")}),children:e.jsx(v,{color:"red",children:s("users.inviteStatus.expired")})}):e.jsx(f,{content:e.jsx(G,{i18nKey:"users.validFromUntil",components:[e.jsx("span",{className:"font-medium"},"from"),e.jsx("span",{className:"font-medium"},"untill")],values:{from:u(new Date(t.original.created_at),"dd MMM, yyyy"),until:u(new Date(t.original.expires_at),"dd MMM, yyyy")}}),children:e.jsx(v,{color:"orange",children:s("users.inviteStatus.pending")})})}}),j.display({id:"actions",cell:({row:a})=>e.jsx(te,{invite:a.original})})],[s])},Ce=()=>e.jsx(p,{children:e.jsx(re,{})});export{Ce as Component};
