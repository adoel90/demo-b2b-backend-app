import{D as ye}from"./chunk-YRY2CZ6I-BH15d-R0.js";import{A as _e}from"./chunk-6T7W3PXQ-e_1GpzQ-.js";import{R as B}from"./chunk-3GWR73RY-BSM_Jeqr.js";import{D as se,C as je}from"./chunk-CNB2IKC7-Ds0ULjOS.js";import{g as be}from"./chunk-MWVM4TYO-bKUcYSnf.js";import{j as e,r as b,b as ve,ad as Ce,ae as Ne,a7 as L,e1 as Fe,t as E,v as g,e2 as we,w as a,H as Ie,a0 as Te,y as p,I as ie,J as k,D as w,ag as Re,B as M,a8 as z,ai as re,aa as y,a9 as d,ak as H,aj as De}from"./index-ozeXIKHB.js";import"./chunk-2PMSBTXI-QP7lqZBs.js";import{K as Se}from"./chunk-6HTZNHPT-Dh7Pdro1.js";import{R as _,u as Ve}from"./chunk-4TC5YS65-CRTXVCux.js";import{T as P}from"./Trans-DRkNJMM6.js";import{P as h}from"./progress-tabs-C6HU22wN.js";import{R as c}from"./radio-group-CD0VosmT.js";import{A as qe}from"./alert-C7CBDsTs.js";import{C as Be}from"./currency-input-C0agNVlR.js";import"./chunk-F6HU4OJ7-BRlVZULW.js";import"./textarea-BDVz6lR4.js";import"./date-picker-ChsOIlAB.js";import"./popover-BY8PlgN4.js";import"./triangle-left-mini-DWPX0Ub-.js";import"./select-B9mkcMq0.js";import"./chunk-HFB3OQXI-BVC_eQ9Y.js";import"./chunk-F6ZOHZVB-BuCD7OJH.js";import"./prompt-BnErB-By.js";var A=re(L({id:d().optional(),attribute:d().min(1,{message:"Required field"}),operator:d().min(1,{message:"Required field"}),values:De([H().min(1,{message:"Required field"}),d().min(1,{message:"Required field"}),re(d()).min(1,{message:"Required field"})]),required:z().optional(),disguised:z().optional(),field_type:d().optional()})),Ee=L({template_id:d().optional(),campaign_id:d().optional(),campaign_choice:y(["none","existing","new"]).optional(),is_automatic:d().toLowerCase(),code:d().min(1),type:y(["buyget","standard"]),status:y(["draft","active","inactive"]),rules:A,is_tax_inclusive:z().optional(),application_method:L({allocation:y(["each","across"]),value:H().min(0),currency_code:d().optional(),max_quantity:H().optional().nullable(),target_rules:A,buy_rules:A,type:y(["fixed","percentage"]),target_type:y(["order","shipping_methods","items"])}),campaign:je.optional()}).refine(f=>f.application_method.allocation==="across"?!0:f.application_method.allocation==="each"&&typeof f.application_method.max_quantity=="number",{path:["application_method.max_quantity"],message:"required field"}),v=["type","application_method.type","application_method.allocation"],ke=[...v],Me=[...v],Pe=[...v,"is_tax_inclusive"],Ae=[...v,"is_tax_inclusive"],Le=[...v,"application_method.value","is_tax_inclusive"],O=[{id:"amount_off_products",type:"standard",title:"Amount off products",description:"Discount specific products or collection of products",hiddenFields:Me,defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"each",target_type:"items",type:"fixed"}}},{id:"amount_off_order",type:"standard",title:"Amount off order",description:"Discounts the total order amount",hiddenFields:ke,defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"across",target_type:"order",type:"fixed"}}},{id:"percentage_off_product",type:"standard",title:"Percentage off product",description:"Discounts a percentage off selected products",hiddenFields:Ae,defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"each",target_type:"items",type:"percentage"}}},{id:"percentage_off_order",type:"standard",title:"Percentage off order",description:"Discounts a percentage of the total order amount",hiddenFields:Pe,defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"across",target_type:"order",type:"percentage"}}},{id:"buy_get",type:"buy_get",title:"Buy X Get Y",description:"Buy X product(s), get Y product(s)",hiddenFields:Le,defaults:{is_automatic:"false",type:"buyget",application_method:{type:"percentage",value:100,apply_to_quantity:1,max_quantity:1}}}],ne={campaign_id:void 0,template_id:O[0].id,campaign_choice:"none",is_automatic:"false",code:"",type:"standard",status:"draft",rules:[],is_tax_inclusive:!1,application_method:{allocation:"each",type:"fixed",target_type:"items",max_quantity:1,target_rules:[],buy_rules:[]},campaign:void 0},ze=()=>{var Y,J,Q,W,Z;const[f,C]=b.useState("type"),[I,N]=b.useState({type:"in-progress",promotion:"not-started",campaign:"not-started"}),{t:o}=ve(),{handleSuccess:le}=Ve(),s=Ce({defaultValues:ne,resolver:Ne(Ee)}),{setValue:u,reset:K,getValues:G}=s,{mutateAsync:ce}=Fe(),de=s.handleSubmit(async t=>{const{campaign_choice:i,is_automatic:n,is_tax_inclusive:m,template_id:x,application_method:xe,rules:ee,...he}=t,{target_rules:te=[],buy_rules:ae=[],...fe}=xe,ge=[...te.filter(l=>!!l.disguised),...ae.filter(l=>!!l.disguised),...ee.filter(l=>!!l.disguised)],oe={};for(const l of ge)oe[l.attribute]=l.field_type==="number"?parseInt(l.values):l.values;const q=l=>l.filter(j=>!j.disguised).map(j=>({operator:j.operator,attribute:j.attribute,values:j.values}));ce({...he,rules:q(ee),application_method:{...fe,...oe,target_rules:q(te),buy_rules:q(ae)},is_tax_inclusive:m,is_automatic:n==="true"},{onSuccess:({promotion:l})=>{E.success(o("promotions.toasts.promotionCreateSuccess",{code:l.code})),le(`/promotions/${l.id}`)},onError:l=>{E.error(l.message)}})},async t=>{const{campaign:i,...n}=t||{};!!Object.keys(n||{}).length&&E.error(o("promotions.errors.promotionTabError"))}),T=async t=>{switch(t){case"type":N(i=>({...i,type:"in-progress"})),C(t);break;case"promotion":N(i=>({...i,type:"completed",promotion:"in-progress"})),C(t);break;case"campaign":{if(!await s.trigger()){N({type:"completed",promotion:"in-progress",campaign:"not-started"}),C("promotion");break}N(n=>({...n,promotion:"completed",campaign:"in-progress"})),C(t);break}}},me=async()=>{switch(f){case"type":T("promotion");break;case"promotion":{await s.trigger()&&T("campaign");break}}},R=g({control:s.control,name:"template_id"}),r=b.useMemo(()=>{const t=O.find(i=>i.id===R);if(t){K({...ne,template_id:R});for(const[i,n]of Object.entries(t.defaults))if(typeof n=="object")for(const[m,x]of Object.entries(n))u(`application_method.${m}`,x);else u(i,n);return t}},[R,u,K]),D=g({control:s.control,name:"application_method.type"})==="fixed",S=g({control:s.control,name:"application_method.allocation"});b.useEffect(()=>{S==="across"&&u("application_method.max_quantity",null)},[S,u]);const V=g({control:s.control,name:"type"})==="standard",pe=g({control:s.control,name:"application_method.target_type"})==="order",U=s.getValues();let $={};U.application_method.currency_code&&($={budget:{currency_code:U.application_method.currency_code}});const{campaigns:ue}=we($),F=g({control:s.control,name:"campaign_choice"});b.useEffect(()=>{var i,n;const t=G();F!=="existing"&&u("campaign_id",void 0),F!=="new"&&u("campaign",void 0),F==="new"&&(!t.campaign||!((n=(i=t.campaign)==null?void 0:i.budget)!=null&&n.type))&&u("campaign",{...se,budget:{...se.budget,currency_code:t.application_method.currency_code}})},[F,G,u]);const X=g({control:s.control,name:"rules"}).find(t=>t.attribute==="currency_code");if(X){const i=s.getValues().application_method.currency_code,n=X.values;!Array.isArray(n)&&i!==n&&s.setValue("application_method.currency_code",n)}return e.jsx(_.Form,{form:s,children:e.jsxs(Se,{className:"flex h-full flex-col",onSubmit:de,children:[e.jsxs(h,{value:f,onValueChange:t=>T(t),className:"flex h-full flex-col overflow-hidden",children:[e.jsx(_.Header,{children:e.jsx("div",{className:"flex w-full items-center justify-between gap-x-4",children:e.jsx("div",{className:"-my-2 w-full max-w-[600px] border-l",children:e.jsxs(h.List,{className:"grid w-full grid-cols-3",children:[e.jsx(h.Trigger,{className:"w-full",value:"type",status:I.type,children:o("promotions.tabs.template")}),e.jsx(h.Trigger,{className:"w-full",value:"promotion",status:I.promotion,children:o("promotions.tabs.details")}),e.jsx(h.Trigger,{className:"w-full",value:"campaign",status:I.campaign,children:o("promotions.tabs.campaign")})]})})})}),e.jsxs(_.Body,{className:"size-full overflow-hidden",children:[e.jsx(h.Content,{value:"type",className:"size-full overflow-y-auto",children:e.jsx("div",{className:"flex size-full flex-col items-center",children:e.jsx("div",{className:"w-full max-w-[720px] py-16",children:e.jsx(a.Field,{control:s.control,name:"template_id",render:({field:t})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("promotions.fields.type")}),e.jsx(a.Control,{children:e.jsx(c,{className:"flex-col gap-y-3",...t,onValueChange:t.onChange,children:O.map(i=>e.jsx(c.ChoiceBox,{value:i.id,label:i.title,description:i.description},i.id))},"template_id")}),e.jsx(a.ErrorMessage,{})]})})})})}),e.jsx(h.Content,{value:"promotion",className:"size-full overflow-y-auto",children:e.jsx("div",{className:"flex size-full flex-col items-center",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 py-16",children:[e.jsxs(Ie,{level:"h1",className:"text-fg-base",children:[o("promotions.sections.details"),(r==null?void 0:r.title)&&e.jsx(Te,{className:"ml-2 align-middle",color:"grey",size:"2xsmall",rounded:"full",children:r==null?void 0:r.title})]}),s.formState.errors.root&&e.jsx(qe,{variant:"error",dismissible:!1,className:"text-balance",children:s.formState.errors.root.message}),e.jsx(a.Field,{control:s.control,name:"is_automatic",render:({field:t})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("promotions.form.method.label")}),e.jsx(a.Control,{children:e.jsxs(c,{className:"flex gap-y-3",...t,value:t.value,onValueChange:t.onChange,children:[e.jsx(c.ChoiceBox,{value:"false",label:o("promotions.form.method.code.title"),description:o("promotions.form.method.code.description"),className:p("basis-1/2")}),e.jsx(c.ChoiceBox,{value:"true",label:o("promotions.form.method.automatic.title"),description:o("promotions.form.method.automatic.description"),className:p("basis-1/2")})]})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx(a.Field,{control:s.control,name:"status",render:({field:t})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("promotions.form.status.label")}),e.jsx(a.Control,{children:e.jsxs(c,{className:"flex gap-y-3",...t,value:t.value,onValueChange:t.onChange,children:[e.jsx(c.ChoiceBox,{value:"draft",label:o("promotions.form.status.draft.title"),description:o("promotions.form.status.draft.description"),className:p("basis-1/2")}),e.jsx(c.ChoiceBox,{value:"active",label:o("promotions.form.status.active.title"),description:o("promotions.form.status.active.description"),className:p("basis-1/2")})]})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx("div",{className:"flex gap-y-4",children:e.jsx(a.Field,{control:s.control,name:"code",render:({field:t})=>e.jsxs(a.Item,{className:"basis-1/2",children:[e.jsx(a.Label,{children:o("promotions.form.code.title")}),e.jsx(a.Control,{children:e.jsx(ie,{...t,placeholder:"SUMMER15"})}),e.jsx(k,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(P,{t:o,i18nKey:"promotions.form.code.description",components:[e.jsx("br",{},"break")]})})]})})}),!((Y=r==null?void 0:r.hiddenFields)!=null&&Y.includes("is_tax_inclusive"))&&e.jsxs(e.Fragment,{children:[e.jsx(w,{}),e.jsx("div",{className:"flex gap-x-2 gap-y-4",children:e.jsx(a.Field,{control:s.control,name:"is_tax_inclusive",render:({field:{onChange:t,value:i,...n}})=>e.jsxs(a.Item,{className:"basis-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"block",children:[e.jsx(a.Label,{children:o("promotions.form.taxInclusive.title")}),e.jsx(a.Hint,{className:"!mt-1",children:o("promotions.form.taxInclusive.description")})]}),e.jsx(a.Control,{className:"mr-2 self-center",children:e.jsx(Re,{className:"mt-[2px]",checked:!!i,onCheckedChange:t,...n})})]}),e.jsx(a.ErrorMessage,{})]})})})]}),!((J=r==null?void 0:r.hiddenFields)!=null&&J.includes("type"))&&e.jsx(a.Field,{control:s.control,name:"type",render:({field:t})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("promotions.fields.type")}),e.jsx(a.Control,{children:e.jsxs(c,{className:"flex gap-y-3",...t,onValueChange:t.onChange,children:[e.jsx(c.ChoiceBox,{value:"standard",label:o("promotions.form.type.standard.title"),description:o("promotions.form.type.standard.description"),className:p("basis-1/2")}),e.jsx(c.ChoiceBox,{value:"buyget",label:o("promotions.form.type.buyget.title"),description:o("promotions.form.type.buyget.description"),className:p("basis-1/2")})]})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx(w,{}),e.jsx(B,{form:s,ruleType:"rules"}),e.jsx(w,{}),!((Q=r==null?void 0:r.hiddenFields)!=null&&Q.includes("application_method.type"))&&e.jsx(a.Field,{control:s.control,name:"application_method.type",render:({field:t})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("promotions.fields.value_type")}),e.jsx(a.Control,{children:e.jsxs(c,{className:"flex gap-y-3",...t,onValueChange:t.onChange,children:[e.jsx(c.ChoiceBox,{value:"fixed",label:o("promotions.form.value_type.fixed.title"),description:o("promotions.form.value_type.fixed.description"),className:p("basis-1/2")}),e.jsx(c.ChoiceBox,{value:"percentage",label:o("promotions.form.value_type.percentage.title"),description:o("promotions.form.value_type.percentage.description"),className:p("basis-1/2")})]})}),e.jsx(a.ErrorMessage,{})]})}),e.jsxs("div",{className:"flex gap-x-2 gap-y-4",children:[!((W=r==null?void 0:r.hiddenFields)!=null&&W.includes("application_method.value"))&&e.jsx(a.Field,{control:s.control,name:"application_method.value",render:({field:{onChange:t,value:i,...n}})=>{const m=s.getValues().application_method.currency_code;return e.jsxs(a.Item,{className:"basis-1/2",children:[e.jsx(a.Label,{tooltip:m||!D?void 0:o("promotions.fields.amount.tooltip"),children:o("promotions.form.value.title")}),e.jsx(a.Control,{children:D?e.jsx(Be,{...n,min:0,onValueChange:x=>{t(x?parseInt(x):"")},code:m||"USD",symbol:m?be(m):"$",value:i,disabled:!m}):e.jsx(ye,{className:"text-right",min:0,max:100,...n,value:i,onChange:x=>{t(x.target.value===""?null:parseInt(x.target.value))}},"amount")}),e.jsx(k,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(P,{t:o,i18nKey:D?"promotions.form.value_type.fixed.description":"promotions.form.value_type.percentage.description",components:[e.jsx("br",{},"break")]})}),e.jsx(a.ErrorMessage,{})]})}}),V&&S==="each"&&e.jsx(a.Field,{control:s.control,name:"application_method.max_quantity",render:({field:t})=>e.jsxs(a.Item,{className:"basis-1/2",children:[e.jsx(a.Label,{children:o("promotions.form.max_quantity.title")}),e.jsx(a.Control,{children:e.jsx(ie,{...s.register("application_method.max_quantity",{valueAsNumber:!0}),type:"number",min:1,placeholder:"3"})}),e.jsx(k,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(P,{t:o,i18nKey:"promotions.form.max_quantity.description",components:[e.jsx("br",{},"break")]})})]})})]}),V&&!((Z=r==null?void 0:r.hiddenFields)!=null&&Z.includes("application_method.allocation"))&&e.jsx(a.Field,{control:s.control,name:"application_method.allocation",render:({field:t})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("promotions.fields.allocation")}),e.jsx(a.Control,{children:e.jsxs(c,{className:"flex gap-y-3",...t,onValueChange:t.onChange,children:[e.jsx(c.ChoiceBox,{value:"each",label:o("promotions.form.allocation.each.title"),description:o("promotions.form.allocation.each.description"),className:p("basis-1/2")}),e.jsx(c.ChoiceBox,{value:"across",label:o("promotions.form.allocation.across.title"),description:o("promotions.form.allocation.across.description"),className:p("basis-1/2")})]})}),e.jsx(a.ErrorMessage,{})]})}),!V&&e.jsx(e.Fragment,{children:e.jsx(B,{form:s,ruleType:"buy-rules",scope:"application_method.buy_rules"})}),!pe&&e.jsxs(e.Fragment,{children:[e.jsx(w,{}),e.jsx(B,{form:s,ruleType:"target-rules",scope:"application_method.target_rules"})]})]})})}),e.jsx(h.Content,{value:"campaign",className:"size-full overflow-auto",children:e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 py-16",children:e.jsx(_e,{form:s,campaigns:ue||[]})})})})]})]}),e.jsx(_.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(_.Close,{asChild:!0,children:e.jsx(M,{variant:"secondary",size:"small",children:o("actions.cancel")})}),f==="campaign"?e.jsx(M,{type:"submit",size:"small",isLoading:!1,children:o("actions.save")},"save-btn"):e.jsx(M,{type:"button",onClick:me,size:"small",children:o("actions.continue")},"continue-btn")]})})]})})},ht=()=>e.jsx(_,{children:e.jsx(ze,{})});export{ht as Component};
