import{u as M}from"./chunk-C76H5USB-BViglmRG.js";import{u as T,_ as A}from"./chunk-B2JT2FOA-oo_VNzF6.js";import{j as e,b as g,ad as k,ae as D,a7 as C,fb as P,H as I,J as E,w as m,I as F,B as U,a9 as R,r as L,f as H,_ as f,bc as u,A as O,b6 as z,fc as B,T as $,bl as q}from"./index-XgOJSAJC.js";import"./chunk-GJUPECDU-C7aenlnj.js";import{K as J}from"./chunk-6HTZNHPT-C-agXnM_.js";import{R as p}from"./chunk-4TC5YS65-Dogq2W_v.js";import{u as K,a as Q,b as V,c as G}from"./chunk-RLY2SL5E-CMwYE5ul.js";import{T as W}from"./Trans-CywRgUZ2.js";import{u as X}from"./use-prompt-DWpbV9Y2.js";import{A as Y}from"./alert-CwUzHpqp.js";import{C as Z}from"./container-C2m-7ajg.js";import{S as v}from"./status-badge-CTYWOBJf.js";import"./chunk-YEDAFXMB-DUOr9QFg.js";import"./chunk-M3VFKDXJ-DK6KjOI-.js";import"./chunk-AOFGTNG6-CQ2QeZj0.js";import"./table-C3tV4tmG.js";import"./chunk-EMIHDNB7-B67ulY0n.js";import"./command-bar-BsVeNHxg.js";import"./chunk-PFKKVLZX-YFrNQd-A.js";import"./_isIndex-7Aeo3_hc.js";import"./date-picker-DyyxMJYe.js";import"./popover-CSmxgaXb.js";import"./triangle-left-mini-CdzRjQvC.js";import"./prompt-StbBEnW7.js";var ee=({prefix:s,pageSize:a=20})=>{const t=M(["offset","q","order","created_at","updated_at"],s),{offset:i,created_at:r,updated_at:n,q:o,order:l}=t;return{searchParams:{limit:a,offset:i?Number(i):0,order:l,created_at:r?JSON.parse(r):void 0,updated_at:n?JSON.parse(n):void 0,q:o},raw:t}},se=C({email:R().email()}),y=10,h="usr_invite",ae=`${window.location.origin}/app/invite?token=`,re=()=>{const{t:s}=g(),a=k({defaultValues:{email:""},resolver:D(se)}),{raw:t,searchParams:i}=ee({prefix:h,pageSize:y}),{invites:r,count:n,isPending:o,isError:l,error:c}=K(i),b=ie(),{table:w}=T({data:r??[],columns:b,count:n,enablePagination:!0,getRowId:d=>d.id,pageSize:y,prefix:h}),{mutateAsync:_,isPending:S}=Q(),N=a.handleSubmit(async d=>{try{await _({email:d.email}),a.reset()}catch(x){if(P(x)&&x.status===400){a.setError("root",{type:"manual",message:x.message});return}}});if(l)throw c;return e.jsx(p.Form,{form:a,children:e.jsxs(J,{onSubmit:N,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(p.Header,{}),e.jsx(p.Body,{className:"flex flex-1 flex-col overflow-hidden",children:e.jsx("div",{className:"flex flex-1 flex-col items-center overflow-y-auto",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 px-2 py-16",children:[e.jsxs("div",{children:[e.jsx(I,{children:s("users.inviteUser")}),e.jsx(E,{size:"small",className:"text-ui-fg-subtle",children:s("users.inviteUserHint")})]}),a.formState.errors.root&&e.jsx(Y,{variant:"error",dismissible:!1,className:"text-balance",children:a.formState.errors.root.message}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsx(m.Field,{control:a.control,name:"email",render:({field:d})=>e.jsxs(m.Item,{children:[e.jsx(m.Label,{children:s("fields.email")}),e.jsx(m.Control,{children:e.jsx(F,{...d})}),e.jsx(m.ErrorMessage,{})]})})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(U,{size:"small",variant:"secondary",type:"submit",isLoading:S,children:s("users.sendInvite")})})]}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(I,{level:"h2",children:s("users.pendingInvites")}),e.jsx(Z,{className:"overflow-hidden p-0",children:e.jsx(A,{table:w,columns:b,count:n,pageSize:y,pagination:!0,search:"autofocus",isLoading:o,queryObject:t,prefix:h,orderBy:[{key:"email",label:s("fields.email")},{key:"created_at",label:s("fields.createdAt")},{key:"updated_at",label:s("fields.updatedAt")}]})})]})]})})})]})})},te=({invite:s})=>{const{mutateAsync:a}=V(s.id),{mutateAsync:t}=G(s.id),i=X(),{t:r}=g(),n=async()=>{await i({title:r("general.areYouSure"),description:r("users.deleteInviteWarning",{email:s.email}),cancelText:r("actions.cancel"),confirmText:r("actions.delete")})&&await a()},o=async()=>{await t()},l=()=>{const c=`${ae}${s.token}`;q(c)};return e.jsx(O,{groups:[{actions:[{icon:e.jsx(z,{}),label:r("users.resendInvite"),onClick:o}]},{actions:[{icon:e.jsx(B,{}),label:r("users.copyInviteLink"),onClick:l}]},{actions:[{icon:e.jsx($,{}),label:r("actions.delete"),onClick:n}]}]})},j=H(),ie=()=>{const{t:s}=g();return L.useMemo(()=>[j.accessor("email",{header:s("fields.email"),cell:({getValue:a})=>a()}),j.accessor("accepted",{header:s("fields.status"),cell:({getValue:a,row:t})=>{const i=a(),r=new Date(t.original.expires_at)<new Date;return i?e.jsx(f,{content:s("users.acceptedOnDate",{date:u(new Date(t.original.updated_at),"dd MMM, yyyy")}),children:e.jsx(v,{color:"green",children:s("users.inviteStatus.accepted")})}):r?e.jsx(f,{content:s("users.expiredOnDate",{date:u(new Date(t.original.expires_at),"dd MMM, yyyy")}),children:e.jsx(v,{color:"red",children:s("users.inviteStatus.expired")})}):e.jsx(f,{content:e.jsx(W,{i18nKey:"users.validFromUntil",components:[e.jsx("span",{className:"font-medium"},"from"),e.jsx("span",{className:"font-medium"},"untill")],values:{from:u(new Date(t.original.created_at),"dd MMM, yyyy"),until:u(new Date(t.original.expires_at),"dd MMM, yyyy")}}),children:e.jsx(v,{color:"orange",children:s("users.inviteStatus.pending")})})}}),j.display({id:"actions",cell:({row:a})=>e.jsx(te,{invite:a.original})})],[s])},ke=()=>e.jsx(p,{children:e.jsx(re,{})});export{ke as Component};
