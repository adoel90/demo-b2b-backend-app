import{u as I,a as z}from"./chunk-PCFUZKDS-BS8frkoq.js";import{W as A,aW as B,j as t,b as x,r as P,ad as H,ae as M,a7 as D,e as N,aX as G,t as h,G as K,B as f,ai as L,a9 as O,f as V,_ as W}from"./index-ozeXIKHB.js";import{u as X,_ as q}from"./chunk-B2JT2FOA-ClytpOI7.js";import{u as Q}from"./chunk-RRZ6HVRV-CMLezHDi.js";import"./chunk-GJUPECDU-BzFLSLeH.js";import{K as U}from"./chunk-6HTZNHPT-Dh7Pdro1.js";import{R as l,u as Z}from"./chunk-4TC5YS65-CRTXVCux.js";import{C as y}from"./checkbox-_eU08wVq.js";import"./chunk-IQBAUTU5-DO3CwvnN.js";import"./chunk-ADOCJB6L-C9hkJ-_l.js";import"./chunk-P3UUX2T6-BIhVcxhd.js";import"./chunk-C76H5USB-DdCB11cb.js";import"./chunk-YEDAFXMB-dVu5MMzv.js";import"./chunk-M3VFKDXJ-D4AM4tlF.js";import"./chunk-AOFGTNG6-4Yn5wtXn.js";import"./table-BKEDbZOL.js";import"./chunk-EMIHDNB7-B6-fh2oC.js";import"./command-bar-CqLJlmwN.js";import"./chunk-PFKKVLZX-8a2WXjA-.js";import"./_isIndex-mOlik3oL.js";import"./date-picker-ChsOIlAB.js";import"./popover-BY8PlgN4.js";import"./triangle-left-mini-DWPX0Ub-.js";import"./prompt-BnErB-By.js";var $=D({product_ids:L(O())}),u=50,m="p",J=({categoryId:c,products:o=[]})=>{const{t:e}=x(),{handleSuccess:a}=Z(),[d,n]=P.useState(o.reduce((s,i)=>(s[i.id]=!0,s),{})),r=H({defaultValues:{product_ids:[]},resolver:M($)}),S=s=>{const i=typeof s=="function"?s(d):s;r.setValue("product_ids",Object.keys(i),{shouldDirty:!0,shouldTouch:!0}),n(i)},{searchParams:b,raw:j}=I({pageSize:u,prefix:m}),{products:C,count:p,isPending:v,isError:_,error:T}=N({...b}),g=ee(),k=Q(["categories"]),{table:E}=X({data:C,columns:g,getRowId:s=>s.id,count:p,pageSize:u,prefix:m,enableRowSelection:s=>!o.some(i=>i.id===s.original.id),enablePagination:!0,rowSelection:{state:d,updater:S}}),{mutateAsync:R,isPending:w}=G(c),F=r.handleSubmit(async s=>{await R({add:s.product_ids},{onSuccess:()=>{h.success(e("categories.products.add.successToast",{count:s.product_ids.length-o.length})),a()},onError:i=>{h.error(i.message)}})});if(_)throw T;return t.jsx(l.Form,{form:r,children:t.jsxs(U,{onSubmit:F,className:"flex h-full flex-col overflow-hidden",children:[t.jsx(l.Header,{children:t.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[r.formState.errors.product_ids&&t.jsx(K,{variant:"error",children:r.formState.errors.product_ids.message}),t.jsx(l.Close,{asChild:!0,children:t.jsx(f,{size:"small",variant:"secondary",children:e("actions.cancel")})}),t.jsx(f,{size:"small",type:"submit",isLoading:w,children:e("actions.save")})]})}),t.jsx(l.Body,{className:"size-full overflow-hidden",children:t.jsx(q,{table:E,columns:g,pageSize:u,count:p,queryObject:j,filters:k,orderBy:[{key:"title",label:e("fields.title")},{key:"created_at",label:e("fields.createdAt")},{key:"updated_at",label:e("fields.updatedAt")}],prefix:m,isLoading:v,layout:"fill",pagination:!0,search:"autofocus"})})]})})},Y=V(),ee=()=>{const{t:c}=x(),o=z();return P.useMemo(()=>[Y.display({id:"select",header:({table:e})=>t.jsx(y,{checked:e.getIsSomePageRowsSelected()?"indeterminate":e.getIsAllPageRowsSelected(),onCheckedChange:a=>e.toggleAllPageRowsSelected(!!a)}),cell:({row:e})=>{const a=!e.getCanSelect(),d=e.getIsSelected()||a,n=t.jsx(y,{checked:d,disabled:a,onCheckedChange:r=>e.toggleSelected(!!r),onClick:r=>{r.stopPropagation()}});return a?t.jsx(W,{content:c("categories.products.add.disabledTooltip"),side:"right",children:n}):n}}),...o],[c,o])},_e=()=>{const{id:c}=A(),{product_category:o,isPending:e,isFetching:a,isError:d,error:n}=B(c,{fields:"products.id"}),r=!e&&!a&&!!o;if(d)throw n;return t.jsx(l,{children:r&&t.jsx(J,{categoryId:o.id,products:o.products})})};export{_e as Component};
